

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>decoys &mdash; SOAP 0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="SOAP 0.1 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">SOAP 0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for decoys</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   SOAP decoy set module.</span>

<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">from</span> <span class="nn">env</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">utility</span> <span class="kn">import</span> <span class="n">mypickle</span>
<span class="kn">from</span> <span class="nn">sequences</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c">#sys.modules[&#39;sp&#39;]=sys.modules[__name__]</span>

<div class="viewcode-block" id="decoys4single"><a class="viewcode-back" href="../decoys.html#decoys.decoys4single">[docs]</a><span class="k">class</span> <span class="nc">decoys4single</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;Single set of decoys, serving as the building block for :class:`decoyset`, corresponding to a single subfolder in the :class:`decoyset`&#39;s folder. All the decoy structure files should present in this subfolder.</span>
<span class="sd">    </span>
<span class="sd">    This class contains utilitis for converting the input decoy strctures in the subfolder into formats necessary for using the decoy structures for statistical potential training, and for copying the prepared decoys into the correponding folders in SGE cluster.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    :Parameters:</span>
<span class="sd">      - `code`: the name for this single set of decoys, which is also the subfolder name.</span>
<span class="sd">      - `dsname`: the :class:`decoyset` name.</span>
<span class="sd">      - `path`: the path to the :class:`decoyset`, the place to create the subfoler for this set of decoys.</span>
<span class="sd">      - `dtype`: list of numpy data types defining the strctured array (you should not change this)</span>
<span class="sd">      - `extrapar`: numpy data types for additonal propertites of each decoy structure is define here</span>
<span class="sd">        specially for atom class features (see :class:`features.AtomType`)&quot;&quot;&quot;</span>
        
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">code</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">dsname</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Intialize the class with :attr:`code`, :attr:`dsname`, and :attr:`path`&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">=</span><span class="n">code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">=</span><span class="n">dsname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">=</span><span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s">&#39;decoyset&#39;</span><span class="p">,</span><span class="s">&#39;i1&#39;</span><span class="p">),(</span><span class="s">&#39;decoyseqposn&#39;</span><span class="p">,</span><span class="s">&#39;i2&#39;</span><span class="p">),(</span><span class="s">&#39;decoyposn&#39;</span><span class="p">,</span><span class="s">&#39;i4&#39;</span><span class="p">),(</span><span class="s">&#39;rmsd&#39;</span><span class="p">,</span><span class="s">&#39;f4&#39;</span><span class="p">),(</span><span class="s">&#39;score&#39;</span><span class="p">,</span><span class="s">&#39;f4&#39;</span><span class="p">),(</span><span class="s">&#39;score2&#39;</span><span class="p">,</span><span class="s">&#39;f4&#39;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extrapar</span><span class="o">=</span><span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">rename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#rename decoy names for easy retrieve</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>
        <span class="n">fl</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&#39;./&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">fl</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">file</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span><span class="o">!=</span><span class="s">&#39;pdb&#39;</span> <span class="ow">and</span> <span class="nb">file</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">:]</span><span class="o">!=</span><span class="s">&#39;pdb.gz&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">file</span><span class="p">[</span><span class="mi">0</span><span class="p">:(</span><span class="mi">2</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="p">))]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="nb">file</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;mv &#39;</span><span class="o">+</span><span class="nb">file</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="nb">file</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;mv &#39;</span><span class="o">+</span><span class="nb">file</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="nb">file</span><span class="p">)</span>
        <span class="c">#print os.system(&#39;for file in *pdb; do mv $file &#39;+self.dsname+&#39;.&#39;+self.code+&#39;.$file; done&#39;)</span>

    <span class="k">def</span> <span class="nf">filter_pdb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#filter the decoys to eliminate bad ones, used for filter HR decoys. Ideally, the input decoys need not be filtered. </span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>
        <span class="n">rmsdlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">flist</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>
        <span class="n">nativepattern</span><span class="o">=</span><span class="s">&#39;native.*pdb$&#39;</span>
        <span class="k">print</span> <span class="s">&#39;running&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span>
        <span class="n">nativef</span><span class="o">=</span><span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">flist</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">nativepattern</span><span class="p">,</span><span class="n">elem</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">nativef</span><span class="p">)</span>
        <span class="n">fhc</span><span class="o">=</span><span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">atomlines</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">n(ATOM.*)&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="n">fhc</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">atomlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">seqnuml</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">seqnamel</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">oldseqnum</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">atomcoord</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">atomlinelist</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">atomnamedict</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">atomline</span> <span class="ow">in</span> <span class="n">atomlines</span><span class="p">:</span>
            <span class="n">atomcode</span><span class="o">=</span><span class="n">atomline</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">atomline</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="o">==</span><span class="s">&#39; &#39;</span> <span class="ow">or</span> <span class="n">atomline</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;A&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">atomcode</span><span class="o">!=</span><span class="s">&#39;OXT&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">atomcode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;H&#39;</span><span class="p">,</span><span class="s">&#39;Q&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">atomcode</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;1H&#39;</span><span class="p">,</span> <span class="s">&#39;2H&#39;</span><span class="p">,</span><span class="s">&#39;3H&#39;</span><span class="p">]):</span>
                <span class="n">atomlinelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atomline</span><span class="p">)</span>
                <span class="n">atomlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atomline</span><span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">26</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">+</span><span class="n">atomline</span><span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">+</span><span class="n">atomline</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">atomline</span><span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">26</span><span class="p">])</span><span class="o">!=</span><span class="n">oldseqnum</span><span class="p">:</span>
                    <span class="n">seqnuml</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">atomline</span><span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">26</span><span class="p">]))</span>
                    <span class="n">seqnamel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atomline</span><span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>
                    <span class="n">oldseqnum</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">atomline</span><span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">26</span><span class="p">])</span>
        <span class="n">atomlistlen</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">atomlist</span><span class="p">)</span>
        <span class="n">atomcoord</span><span class="p">[</span><span class="n">nativef</span><span class="p">]</span><span class="o">=</span><span class="n">atomlinelist</span>
        <span class="n">atomnamedict</span><span class="p">[</span><span class="n">nativef</span><span class="p">]</span><span class="o">=</span><span class="n">atomlist</span>
        <span class="c">#fist filter the decoy structures to eliminate outliers</span>
        <span class="n">otherf</span><span class="o">=</span><span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">flist</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;pdb$&#39;</span><span class="p">,</span> <span class="n">elem</span><span class="p">)]</span>
        <span class="n">otherf</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">nativef</span><span class="p">)</span>
        <span class="n">posdiffl</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">atomdict</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">otherffiltered</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">otherprotein</span> <span class="ow">in</span> <span class="n">otherf</span><span class="p">:</span>
            <span class="n">fs</span><span class="o">=</span><span class="s">&#39;&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fht</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">otherprotein</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">fhtc</span><span class="o">=</span><span class="n">fht</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">tatomlines</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">n(ATOM.*)&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="n">fhtc</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">oldseqnum</span><span class="o">=</span><span class="mi">0</span>
                <span class="n">tseqnuml</span><span class="o">=</span><span class="p">[]</span>
                <span class="n">tseqnamel</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">tatomline</span> <span class="ow">in</span> <span class="n">tatomlines</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">tatomline</span><span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">26</span><span class="p">])</span><span class="o">!=</span><span class="n">oldseqnum</span><span class="p">:</span>
                        <span class="n">tseqnuml</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tatomline</span><span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">26</span><span class="p">]))</span>
                        <span class="n">tseqnamel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tatomline</span><span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>
                        <span class="n">oldseqnum</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">tatomline</span><span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">26</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">tatomline</span>
                <span class="k">print</span> <span class="s">&#39;structure problem &#39;</span><span class="o">+</span><span class="n">otherprotein</span>
                <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;mv &#39;</span><span class="o">+</span><span class="n">otherprotein</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="n">otherprotein</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;.atombad&#39;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">posdiff</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">align_seq</span><span class="p">(</span><span class="n">seqnamel</span><span class="p">,</span><span class="n">seqnuml</span><span class="p">,</span><span class="n">tseqnamel</span><span class="p">,</span><span class="n">tseqnuml</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">posdiff</span><span class="o">==-</span><span class="mi">9999</span><span class="p">:</span>
                <span class="c">#if the decoy structure can not be aligned with the native structure, mark it as a bad structure</span>
                <span class="k">print</span> <span class="s">&#39;can not align with native &#39;</span><span class="o">+</span><span class="n">otherprotein</span>
                <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;mv &#39;</span><span class="o">+</span><span class="n">otherprotein</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="n">otherprotein</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;.alnbad&#39;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">posdiffl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posdiff</span><span class="p">)</span>
            <span class="n">tatomlist</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">atomlinelist</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">tatomline</span> <span class="ow">in</span> <span class="n">tatomlines</span><span class="p">:</span>
                <span class="n">atomnamestr</span><span class="o">=</span><span class="n">tatomline</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">atomnamestr</span><span class="o">==</span><span class="s">&#39;OT1&#39;</span><span class="p">:</span>
                    <span class="n">atomnamestr</span><span class="o">=</span><span class="s">&#39;O&#39;</span>
                    <span class="n">tatomline</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;OT1&#39;</span><span class="p">,</span><span class="s">&#39;O  &#39;</span><span class="p">)</span>
                <span class="n">atomlinelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tatomline</span><span class="p">)</span>
                <span class="n">atomstr</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tatomline</span><span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">26</span><span class="p">])</span><span class="o">+</span><span class="n">posdiff</span><span class="p">)</span><span class="o">+</span><span class="n">tatomline</span><span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">+</span><span class="n">atomnamestr</span>
                <span class="n">tatomlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atomstr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">atomstr</span> <span class="ow">in</span> <span class="n">atomdict</span><span class="p">:</span>
                    <span class="n">atomdict</span><span class="p">[</span><span class="n">atomstr</span><span class="p">]</span><span class="o">=</span><span class="n">atomdict</span><span class="p">[</span><span class="n">atomstr</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">atomdict</span><span class="p">[</span><span class="n">atomstr</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">atomcoord</span><span class="p">[</span><span class="n">otherprotein</span><span class="p">]</span><span class="o">=</span><span class="n">atomlinelist</span>
            <span class="n">atomnamedict</span><span class="p">[</span><span class="n">otherprotein</span><span class="p">]</span><span class="o">=</span><span class="n">tatomlist</span>
            <span class="n">otherffiltered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">otherprotein</span><span class="p">)</span>
        <span class="n">otherf</span><span class="o">=</span><span class="n">otherffiltered</span>
        <span class="c">#calculate the concensus atom list of decoys</span>
        <span class="n">tatomlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">minnum</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">otherf</span><span class="p">)</span><span class="o">*</span><span class="mf">0.7</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">otherf</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">atomdict</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">atomdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">&gt;</span><span class="n">minnum</span><span class="p">:</span>
                <span class="n">tatomlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="c">#build the final atom list based on both decoys and native structures</span>
        <span class="n">newatomlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">atomlist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">tatomlist</span><span class="p">:</span>
                <span class="n">newatomlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;native structure and decoys uncommon atom &#39;</span><span class="o">+</span><span class="n">item</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newatomlist</span><span class="p">)</span><span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">atomlist</span><span class="p">)</span><span class="o">*</span><span class="mf">0.90</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">nativef</span>
            <span class="k">print</span> <span class="s">&#39;too many missing atoms&#39;</span>
            <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
        <span class="n">atomlist</span><span class="o">=</span><span class="n">newatomlist</span>
        <span class="c">#now filter both the native and the decoy structure based on the list</span>
        <span class="n">otherf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nativef</span><span class="p">)</span>
        <span class="n">posdiffl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">k</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">otherprotein</span> <span class="ow">in</span> <span class="n">otherf</span><span class="p">:</span>
            <span class="n">fs</span><span class="o">=</span><span class="s">&#39;&#39;</span>
            <span class="n">atomlines</span><span class="o">=</span><span class="n">atomcoord</span><span class="p">[</span><span class="n">otherprotein</span><span class="p">]</span>
            <span class="n">atomnames</span><span class="o">=</span><span class="n">atomnamedict</span><span class="p">[</span><span class="n">otherprotein</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atomlist</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">index</span><span class="o">=</span><span class="n">atomnames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">print</span> <span class="n">otherprotein</span><span class="o">+</span><span class="s">&#39; missing atoms &#39;</span><span class="o">+</span><span class="n">atom</span>
                    <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;mv &#39;</span><span class="o">+</span><span class="n">otherprotein</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="n">otherprotein</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">atom</span><span class="o">+</span><span class="s">&#39;.bad&#39;</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="o">+</span><span class="n">atomlines</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">fht</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">otherprotein</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">fht</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>
            <span class="n">fht</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">fht</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">align_seq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">seqnamel</span><span class="p">,</span><span class="n">seqnuml</span><span class="p">,</span><span class="n">tseqnamel</span><span class="p">,</span><span class="n">tseqnuml</span><span class="p">):</span>
        <span class="n">k</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">i</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">seqnamel</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span>
        <span class="n">fail</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">seqnamel</span><span class="p">)</span><span class="o">-</span><span class="mi">10</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">while</span> <span class="nb">sum</span><span class="p">(</span><span class="n">seqnuml</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">10</span><span class="p">])</span><span class="o">!=</span><span class="p">(</span><span class="n">seqnuml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="mi">45</span><span class="p">):</span>
                    <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">seq10</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">seqnamel</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">10</span><span class="p">])</span>
                <span class="n">seqpos</span><span class="o">=</span><span class="n">seqnuml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">tseqnames</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tseqnamel</span><span class="p">[</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">10</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tseqnamel</span><span class="p">)</span><span class="o">-</span><span class="mi">10</span><span class="p">)]</span>
                <span class="n">index</span><span class="o">=</span><span class="n">tseqnames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">seq10</span><span class="p">)</span>    
                <span class="n">tseqpos</span><span class="o">=</span><span class="n">tseqnuml</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">posdiff</span><span class="o">=</span><span class="n">seqpos</span><span class="o">-</span><span class="n">tseqpos</span>
                <span class="n">fail</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">i</span><span class="o">=</span><span class="n">k</span>
                <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">fail</span><span class="p">:</span>
            <span class="n">posdiff</span><span class="o">=-</span><span class="mi">9999</span>
        <span class="k">return</span> <span class="n">posdiff</span>
         
    <span class="k">def</span> <span class="nf">copy2ddb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#copy decoys to jobserver</span>
        <span class="n">tdir</span><span class="o">=</span><span class="n">runenv</span><span class="o">.</span><span class="n">serverUserPath</span><span class="o">+</span><span class="s">&#39;decoys/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;gzip *pdb&#39;</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;gunzip *base*&#39;</span><span class="p">)</span>
        <span class="n">pdblist</span><span class="o">=</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">item</span><span class="o">+</span><span class="s">&#39;.pdb.gz&#39;</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">])</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;ssh &#39;</span><span class="o">+</span><span class="n">runenv</span><span class="o">.</span><span class="n">jobserver</span><span class="o">+</span><span class="s">&#39; mkdir &#39;</span><span class="o">+</span><span class="n">tdir</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;scp *.pdb.gz &#39;</span><span class="o">+</span><span class="n">runenv</span><span class="o">.</span><span class="n">jobserver</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">tdir</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;scp *base* &#39;</span><span class="o">+</span><span class="n">runenv</span><span class="o">.</span><span class="n">jobserver</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">tdir</span><span class="p">)</span>
    
<div class="viewcode-block" id="decoys4single.calc_rmsd"><a class="viewcode-back" href="../decoys.html#decoys.decoys4single.calc_rmsd">[docs]</a>    <span class="k">def</span> <span class="nf">calc_rmsd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nativepattern</span><span class="o">=</span><span class="s">&#39;*native*pdb$&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calcualte the RMSDs for the decoys</span>
<span class="sd">        It takse either the rosetta sc file, rmsd.pickle, or raw decoys files with a native structure (named *native*pdb).</span>
<span class="sd">        rmsd.pickle</span>
<span class="sd">        {decoyname:rmsdvalue} or {decoyname:[rmsdvalue,extra propertitis defined by extrapar]}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#change the native name to be native.pdb</span>
        <span class="n">fl</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&#39;./&#39;</span><span class="p">)</span>
        <span class="n">sfl</span><span class="o">=</span><span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">fl</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;sc&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sfl</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_rmsd_rosettadock</span><span class="p">(</span><span class="n">sfl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">sfl</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;more than 1 score file, do not know how to handle&#39;</span><span class="p">)</span>
        <span class="n">flist</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>
        <span class="n">rmsdfl</span><span class="o">=</span><span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">flist</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;rmsd&#39;</span><span class="p">,</span><span class="n">elem</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;matlab&#39;</span><span class="p">,</span><span class="n">elem</span><span class="p">)]</span>
        <span class="k">print</span> <span class="n">rmsdfl</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rmsdfl</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_rmsd_fromfiles</span><span class="p">()</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">rmsdfl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;rmsd.pickle&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_rmsd</span><span class="p">(</span><span class="n">rmsdfl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">rmsdf</span><span class="o">=</span><span class="n">rmsdfl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rmsdfh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">rmsdf</span><span class="p">)</span>
        <span class="n">rmsdfc</span><span class="o">=</span><span class="n">rmsdfh</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">rmsdfh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">nativef</span><span class="o">=</span><span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">flist</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">nativepattern</span><span class="p">,</span><span class="n">elem</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">flist</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">nativef</span><span class="p">)</span>
        <span class="n">otherf</span><span class="o">=</span><span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">flist</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;pdb$&#39;</span><span class="p">,</span> <span class="n">elem</span><span class="p">)]</span>
        <span class="n">rmsdlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">rmsdlist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">nativef</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">],</span><span class="mf">0.0</span><span class="p">])</span>
        <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">otherf</span><span class="p">:</span>
            <span class="n">filenamelist</span><span class="o">=</span><span class="nb">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">==</span><span class="s">&#39;HR&#39;</span><span class="p">:</span>
                <span class="n">rer</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;\s*&#39;</span><span class="o">+</span><span class="n">filenamelist</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;\s+([0-9\.]+)\s*</span><span class="se">\\</span><span class="s">n&#39;</span><span class="p">,</span><span class="n">rmsdfc</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rer</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filenamelist</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:])</span><span class="o">+</span><span class="s">&#39;\s+is\s+([0-9\.]+)\s*</span><span class="se">\\</span><span class="s">n&#39;</span><span class="p">,</span><span class="n">rmsdfc</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">rer</span><span class="p">:</span>
                    <span class="n">rer</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filenamelist</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span><span class="o">+</span><span class="s">&#39;\s+is\s+([0-9\.]+)\s*</span><span class="se">\\</span><span class="s">n&#39;</span><span class="p">,</span><span class="n">rmsdfc</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rmsdlist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">file</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">],</span><span class="nb">float</span><span class="p">(</span><span class="n">rer</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
        <span class="n">rmsdlist</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">rmsdlist</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_sa</span><span class="p">(</span><span class="n">rmsdlist</span><span class="p">)</span>  
    </div>
    <span class="k">def</span> <span class="nf">build_sa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rmsdlist</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;building sa&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">extrapar</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="s">&#39;rmsd&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">rmsdlist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">k</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrapar</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">rmsdlist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="s">&#39;score&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span>
        <span class="k">print</span> <span class="s">&quot;building sa finished&quot;</span>
            
    <span class="k">def</span> <span class="nf">read_rmsd_rosettadock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rmsdf</span><span class="p">):</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">rmsdf</span><span class="p">)</span>
        <span class="n">rmsdlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">k</span><span class="o">=-</span><span class="mi">1</span>
        <span class="n">fl</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&#39;./&#39;</span><span class="p">)</span>
        <span class="n">pdbfl</span><span class="o">=</span><span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">fl</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.pdb&#39;</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fh</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span>
                <span class="k">continue</span>
            <span class="n">ls</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">):</span>
                    <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;&#39;</span>
                <span class="k">elif</span> <span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">):</span>
                    <span class="n">prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span><span class="o">+</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">pdbfl</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">rmsdlist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">prefix</span><span class="o">+</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()[:</span><span class="o">-</span><span class="mi">4</span><span class="p">],</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>
            <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extrapar</span><span class="o">=</span><span class="p">[(</span><span class="s">&#39;strmad&#39;</span><span class="p">,</span><span class="s">&#39;f4&#39;</span><span class="p">)]</span>
        <span class="n">rmsdlist</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">rmsdlist</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">rmsdlist</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_sa</span><span class="p">(</span><span class="n">rmsdlist</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_rmsd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rmsdf</span><span class="p">):</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">rmsdf</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
        <span class="n">rmsddict</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">rmsdlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">k</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">dopescore</span><span class="o">=</span><span class="bp">False</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s">&#39;score.pickle&#39;</span><span class="p">):</span>
            <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;score.pickle&#39;</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
            <span class="n">dopescore</span><span class="o">=</span><span class="bp">True</span>
            <span class="n">dopedict</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s">&#39;extrapar.pickle&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extrapar</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;extrapar.pickle&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">rmsddict</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dopescore</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">dopedict</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dopedict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="p">):</span>
                    <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;&#39;</span>
                <span class="k">elif</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="p">):</span>
                    <span class="n">prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rmsddict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s">&#39;extrapar.pickle&#39;</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;no extrapar specified&#39;</span><span class="p">)</span>
                <span class="n">rmsdlist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">prefix</span><span class="o">+</span><span class="n">key</span><span class="p">]</span><span class="o">+</span><span class="n">rmsddict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rmsdlist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">prefix</span><span class="o">+</span><span class="n">key</span><span class="p">,</span><span class="n">rmsddict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">key</span><span class="p">])</span> 
        <span class="n">rmsdlist</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">rmsdlist</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_sa</span><span class="p">(</span><span class="n">rmsdlist</span><span class="p">)</span>  
        
    <span class="k">def</span> <span class="nf">calc_rmsd_fromfiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nativepattern</span><span class="o">=</span><span class="s">&#39;native.*pdb$&#39;</span><span class="p">):</span>
        <span class="c">#calculate rmsd for files in a single directory#</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>
        <span class="n">rmsdlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">flist</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>
        <span class="n">rmsdfile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">+</span><span class="s">&#39;.pir&#39;</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">nativef</span><span class="o">=</span><span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">flist</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">nativepattern</span><span class="p">,</span><span class="n">elem</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rmsdfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;cRMSD between &#39;</span><span class="o">+</span><span class="n">nativef</span><span class="o">+</span><span class="s">&#39; and &#39;</span><span class="o">+</span><span class="n">nativef</span><span class="o">+</span><span class="s">&#39; is   &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">rmsdlist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">nativef</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">],</span><span class="mf">0.0</span><span class="p">])</span>
        <span class="n">flist</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">nativef</span><span class="p">)</span>
        <span class="n">otherf</span><span class="o">=</span><span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">flist</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;pdb$&#39;</span><span class="p">,</span> <span class="n">elem</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">otherf</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> 
                <span class="n">rmsdv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rmsd_2file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="o">+</span><span class="n">nativef</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
                <span class="n">rmsdfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;RMSD between &#39;</span><span class="o">+</span><span class="n">nativef</span><span class="o">+</span><span class="s">&#39; and &#39;</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s">&#39; is   &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rmsdv</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">rmsdlist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">],</span><span class="n">rmsdv</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="n">rmsdfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">rmsdlist</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">rmsdlist</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_sa</span><span class="p">(</span><span class="n">rmsdlist</span><span class="p">)</span>  
    
<div class="viewcode-block" id="decoys4single.build"><a class="viewcode-back" href="../decoys.html#decoys.decoys4single.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">filter</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        needattachtobase</span>
<span class="sd">        needtransformation</span>
<span class="sd">        needcombinewithbase</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#pdb.set_trace()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s">&quot;ma&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_dockingdecoys_ma</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.zd3.0.zr.out&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_dockingdecoys_zdock</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s">&quot;needtransformation&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_dockingdecoys_withtransformation</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rename</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">filter</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filter_pdb</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_rmsd</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s">&#39;base.pir&#39;</span><span class="p">):</span><span class="c"># or os.path.isfile(&#39;needattachtobase&#39;):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">make_basepir</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">replicate_pir</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>                
                <span class="n">ndnlist</span><span class="o">=</span><span class="n">pir</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">+</span><span class="s">&#39;.pir&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">make_pir_fromlist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ndnlist</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">):</span>
                    <span class="n">nindex</span><span class="o">=</span><span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ndnlist</span><span class="p">:</span>
                            <span class="n">nindex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="o">=</span><span class="n">ndnlist</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="n">nindex</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copy2ddb</span><span class="p">()</span>
     </div>
    <span class="k">def</span> <span class="nf">make_basepir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="n">fl</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&#39;./&#39;</span><span class="p">)</span>
        <span class="n">bf</span><span class="o">=</span><span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fl</span> <span class="k">if</span> <span class="s">&#39;base&#39;</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;pdb&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.pdb.gz&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;gz&#39;</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">nativefile</span><span class="o">=</span><span class="n">path</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s">&quot;needtransformation&quot;</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s">&#39;basebase.pir&#39;</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">bf</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s">&#39;needcombinewithbase&#39;</span><span class="p">):</span>
            <span class="n">basefile</span><span class="o">=</span><span class="n">bf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">fh</span><span class="o">=</span><span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">basefile</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">fc</span><span class="o">=</span><span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">fh</span><span class="o">=</span><span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.native.pdb.gz&#39;</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">dfc</span><span class="o">=</span><span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">fc</span><span class="o">=</span><span class="n">fc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;replacethis&#39;</span><span class="p">,</span><span class="n">dfc</span><span class="p">)</span>
            <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;nativepdb&#39;</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fc</span><span class="p">)</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">nativefile</span><span class="o">=</span><span class="s">&#39;nativepdb&#39;</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">bf</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s">&#39;needattachtobase&#39;</span><span class="p">):</span>
            <span class="n">nativeligand</span><span class="o">=</span><span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fl</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;pdb.gz&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;pdb&#39;</span><span class="p">))][</span><span class="mi">0</span><span class="p">]</span>                
            <span class="k">if</span> <span class="s">&#39;gz&#39;</span> <span class="ow">in</span> <span class="n">nativeligand</span><span class="p">:</span>
                <span class="n">lf</span><span class="o">=</span><span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">nativeligand</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lf</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">nativeligand</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="s">&#39;gz&#39;</span> <span class="ow">in</span> <span class="n">bf</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="nb">open</span><span class="p">(</span><span class="s">&#39;temp&#39;</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">bf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="n">lf</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">open</span><span class="p">(</span><span class="s">&#39;temp&#39;</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">bf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="n">lf</span><span class="p">)</span>
            <span class="n">nativefile</span><span class="o">=</span><span class="s">&#39;temp&#39;</span>       
        <span class="n">env</span><span class="o">=</span><span class="n">environ</span><span class="p">()</span>
        <span class="n">mdl</span><span class="o">=</span><span class="n">model</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="nb">file</span><span class="o">=</span><span class="n">nativefile</span><span class="p">)</span>
        <span class="n">aln</span><span class="o">=</span><span class="n">alignment</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="n">aln</span><span class="o">.</span><span class="n">append_model</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span><span class="n">align_codes</span><span class="o">=</span><span class="s">&#39;base&#39;</span><span class="p">)</span>
        <span class="n">aln</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;tbrname&#39;</span>
        <span class="n">aln</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;base.pir&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">build_dockingdecoys_ma</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&#39;building docking decoys&#39;</span>
        <span class="n">fl</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&#39;./&#39;</span><span class="p">)</span>
        <span class="c">#renaming the chains</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;PatchDock/mainchain.pl &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;_r_u.pdb A&#39;</span><span class="p">)</span><span class="c">#use unbound</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;PatchDock/mainchain.pl &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;_l_u.pdb B&#39;</span><span class="p">)</span>
        <span class="c">#combine the two files</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;_r_b.pdb&#39;</span><span class="p">,</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39; cat &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;_r_u.pdb &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;_l_u.pdb &gt; &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.base.pdb&#39;</span><span class="p">)</span> 
        <span class="c">#generate pir file for the base structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_basepir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.base.pdb&#39;</span><span class="p">)</span>
        <span class="n">basepir</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;base.pir&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">totalpir</span><span class="o">=</span><span class="n">basepir</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;base&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.base&#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.pir&#39;</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">totalpir</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c">#Read in the rmad, transformation matrix</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;ma&#39;</span><span class="p">)</span>
        <span class="n">fc</span><span class="o">=</span><span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">fcl</span><span class="o">=</span><span class="n">fc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">va</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">fcl</span><span class="p">]</span>
        <span class="n">rmsdlist</span><span class="o">=</span><span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.base&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">va</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">rmsdlist</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extrapar</span><span class="o">=</span><span class="p">[(</span><span class="s">&#39;dg&#39;</span><span class="p">,</span><span class="s">&#39;f4&#39;</span><span class="p">),(</span><span class="s">&#39;dasa&#39;</span><span class="p">,</span><span class="s">&#39;f4&#39;</span><span class="p">),(</span><span class="s">&#39;irmsd&#39;</span><span class="p">,</span><span class="s">&#39;f4&#39;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_sa</span><span class="p">(</span><span class="n">rmsdlist</span><span class="p">)</span>  
        <span class="c">#copy to cluster</span>
        <span class="n">tdir</span><span class="o">=</span><span class="n">runenv</span><span class="o">.</span><span class="n">serverUserPath</span><span class="o">+</span><span class="s">&#39;decoys/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;ssh &#39;</span><span class="o">+</span><span class="n">runenv</span><span class="o">.</span><span class="n">jobserver</span><span class="o">+</span><span class="s">&#39; mkdir &#39;</span><span class="o">+</span><span class="n">tdir</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;scp *base* &#39;</span><span class="o">+</span><span class="n">runenv</span><span class="o">.</span><span class="n">jobserver</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">tdir</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;scp need* &#39;</span><span class="o">+</span><span class="n">runenv</span><span class="o">.</span><span class="n">jobserver</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">tdir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">build_dockingdecoys_zdock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&#39;building docking decoys&#39;</span>
        <span class="n">fl</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&#39;./&#39;</span><span class="p">)</span>
        <span class="n">pdbfilelist</span><span class="o">=</span><span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">fl</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;pdb&#39;</span><span class="p">)]</span>
        <span class="c">#renaming the chains</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;cp &#39;</span><span class="o">+</span><span class="n">runenv</span><span class="o">.</span><span class="n">ddbdir</span><span class="o">+</span><span class="s">&#39;ppd/benchmark4/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;* ./&#39;</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;PatchDock/mainchain.pl &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;_r_u.pdb A&#39;</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;PatchDock/mainchain.pl &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;_l_u.pdb B&#39;</span><span class="p">)</span>
        <span class="c">#combine the two files</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;_r_u.pdb&#39;</span><span class="p">,</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39; cat &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;_r_u.pdb &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;_l_u.pdb &gt; &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.base.pdb&#39;</span><span class="p">)</span> 
        <span class="c">#generate pir file for the base structure</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;touch needtransformation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_basepir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.base.pdb&#39;</span><span class="p">)</span>
        <span class="c">#Read in the rmad, transformation matrix</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;rmsd.res&#39;</span><span class="p">)</span>
        <span class="n">collect</span><span class="o">=</span><span class="bp">False</span>
        <span class="n">rmsdlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">transmatrixlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">score</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fh</span><span class="p">:</span>
            <span class="c">#if re.search(&#39;# | rmsd&#39;,line):</span>
            <span class="c">#    collect=True</span>
            <span class="c">#    continue</span>
            <span class="k">if</span> <span class="bp">True</span><span class="p">:</span><span class="c">#collect:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;|&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">srmsd</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">irmsd</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">rmsdlist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span><span class="n">srmsd</span><span class="p">,</span><span class="n">irmsd</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                    <span class="c">#pdb.set_trace()</span>
        <span class="n">k</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">rfh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.zd3.0.zr.out.rmsds&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">rfh</span><span class="p">:</span>
            <span class="n">rmsdlist</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">k</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">sfh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.zd3.0.zr.out.scores.txt&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sfh</span><span class="p">:</span>
            <span class="n">rmsdlist</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">rmsdlist</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">transmatrixlist</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">rmsdlist</span><span class="p">]</span>
        <span class="n">rmsdlist</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">rmsdlist</span><span class="p">]</span>        
        <span class="n">scorelist</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">rmsdlist</span><span class="p">]</span>
        <span class="n">rmsdlist</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">rmsdlist</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">rmsdlist</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extrapar</span><span class="o">=</span><span class="p">[(</span><span class="s">&#39;irmsd&#39;</span><span class="p">,</span><span class="s">&#39;f4&#39;</span><span class="p">),(</span><span class="s">&#39;birmsd&#39;</span><span class="p">,</span><span class="s">&#39;f4&#39;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_sa</span><span class="p">(</span><span class="n">rmsdlist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="s">&#39;score&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scorelist</span><span class="p">)</span>
        <span class="c">#replicate the pir file</span>
        <span class="n">basepir</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;base.pir&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">bpl</span><span class="o">=</span><span class="n">basepir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-1.00</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">basepir</span><span class="o">=</span><span class="n">bpl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;-1.00</span><span class="se">\n</span><span class="s">ACS*</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">totalpir</span><span class="o">=</span><span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">)):</span>
            <span class="n">totalpir</span><span class="o">=</span><span class="n">totalpir</span><span class="o">+</span><span class="n">basepir</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;base&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;tbrname&#39;</span><span class="p">,</span><span class="n">transmatrixlist</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.pir&#39;</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">totalpir</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c">#copy files to cluster</span>
        <span class="n">tdir</span><span class="o">=</span><span class="n">runenv</span><span class="o">.</span><span class="n">serverUserPath</span><span class="o">+</span><span class="s">&#39;decoys/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;ssh &#39;</span><span class="o">+</span><span class="n">runenv</span><span class="o">.</span><span class="n">jobserver</span><span class="o">+</span><span class="s">&#39; mkdir &#39;</span><span class="o">+</span><span class="n">tdir</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;scp *base* &#39;</span><span class="o">+</span><span class="n">runenv</span><span class="o">.</span><span class="n">jobserver</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">tdir</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;scp need* &#39;</span><span class="o">+</span><span class="n">runenv</span><span class="o">.</span><span class="n">jobserver</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">tdir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">build_dockingdecoys_withtransformation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;firedockinput.pickle&#39;</span><span class="p">)</span>
        <span class="n">sd</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&#39;building docking decoys&#39;</span>
        <span class="n">fl</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&#39;./&#39;</span><span class="p">)</span>
        <span class="n">pf</span><span class="o">=</span><span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">fl</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;_r_&#39;</span><span class="p">,</span><span class="n">item</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lf</span><span class="o">=</span><span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">fl</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;_l_&#39;</span><span class="p">,</span><span class="n">item</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">resfile</span><span class="o">=</span><span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">fl</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span><span class="o">==</span><span class="s">&#39;res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#renaming the chains</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;PatchDock/mainchain.pl &#39;</span><span class="o">+</span><span class="n">sd</span><span class="p">[</span><span class="s">&#39;rpdb&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; A&#39;</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;PatchDock/mainchain.pl &#39;</span><span class="o">+</span><span class="n">sd</span><span class="p">[</span><span class="s">&#39;lpdb&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; B&#39;</span><span class="p">)</span>
        <span class="c">#combine the two files</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39; cat &#39;</span><span class="o">+</span><span class="n">sd</span><span class="p">[</span><span class="s">&#39;rpdb&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="n">sd</span><span class="p">[</span><span class="s">&#39;lpdb&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; &gt; &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.base.pdb&#39;</span><span class="p">)</span> 
        <span class="c">#generate pir file for the base structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_basepir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.base.pdb&#39;</span><span class="p">)</span>
        <span class="c">#Read in the rmad, transformation matrix</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">resfile</span><span class="p">)</span>
        <span class="n">collect</span><span class="o">=</span><span class="bp">False</span>
        <span class="n">rmsdlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">transmatrixlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">print</span> <span class="s">&quot;Getting list&quot;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fh</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;# | rmsd&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">):</span>
                <span class="n">collect</span><span class="o">=</span><span class="bp">True</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">collect</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;|&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">srmsd</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">irmsd</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">rmsdlist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span><span class="n">srmsd</span><span class="p">,</span><span class="n">irmsd</span><span class="p">,</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                    <span class="c">#pdb.set_trace()</span>
        <span class="k">print</span> <span class="s">&quot;Finished getting list&quot;</span>
        <span class="n">rmsdlist</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">print</span> <span class="s">&quot;sort finished&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">rmsdlist</span><span class="p">]</span>
        <span class="n">transmatrixlist</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">rmsdlist</span><span class="p">]</span>
        <span class="n">rmsdlist</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">rmsdlist</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extrapar</span><span class="o">=</span><span class="p">[(</span><span class="s">&#39;irmsd&#39;</span><span class="p">,</span><span class="s">&#39;f4&#39;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_sa</span><span class="p">(</span><span class="n">rmsdlist</span><span class="p">)</span>  
        <span class="c">#replicate the pir file</span>
        <span class="n">basepir</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;base.pir&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>     
        <span class="n">bpl</span><span class="o">=</span><span class="n">basepir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-1.00</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">sl</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bpl</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span><span class="o">/</span><span class="mi">50</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">residuecodes</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;A&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sl</span><span class="p">)])</span>           
        <span class="n">basepir</span><span class="o">=</span><span class="n">bpl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;-1.00</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="n">residuecodes</span><span class="o">+</span><span class="s">&#39;*</span><span class="se">\n\n</span><span class="s">&#39;</span>
        <span class="n">totalpir</span><span class="o">=</span><span class="s">&#39;&#39;</span>
        <span class="k">print</span> <span class="s">&quot;generating pir&quot;</span>
        <span class="n">basepirlist</span><span class="o">=</span><span class="n">basepir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;base&#39;</span><span class="p">)</span>
        <span class="n">basepirlist</span><span class="o">=</span><span class="n">basepirlist</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">basepirlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;tbrname&#39;</span><span class="p">)</span>
        <span class="n">totalpir</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">basepirlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">+</span><span class="n">basepirlist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">+</span><span class="n">basepirlist</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">transmatrixlist</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">+</span><span class="n">basepirlist</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">))])</span>
        <span class="k">print</span> <span class="s">&quot;generating pir finished&quot;</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.pir&#39;</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">totalpir</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">tdir</span><span class="o">=</span><span class="n">runenv</span><span class="o">.</span><span class="n">serverUserPath</span><span class="o">+</span><span class="s">&#39;decoys/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;ssh &#39;</span><span class="o">+</span><span class="n">runenv</span><span class="o">.</span><span class="n">jobserver</span><span class="o">+</span><span class="s">&#39; mkdir &#39;</span><span class="o">+</span><span class="n">tdir</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;scp *base* &#39;</span><span class="o">+</span><span class="n">runenv</span><span class="o">.</span><span class="n">jobserver</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">tdir</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;scp need* &#39;</span><span class="o">+</span><span class="n">runenv</span><span class="o">.</span><span class="n">jobserver</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">tdir</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;scp &#39;</span><span class="o">+</span><span class="n">sd</span><span class="p">[</span><span class="s">&#39;lpdb&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="n">runenv</span><span class="o">.</span><span class="n">jobserver</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">tdir</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;scp &#39;</span><span class="o">+</span><span class="n">sd</span><span class="p">[</span><span class="s">&#39;rpdb&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="n">runenv</span><span class="o">.</span><span class="n">jobserver</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">tdir</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;scp &#39;</span><span class="o">+</span><span class="s">&#39;firedockinput.pickle &#39;</span><span class="o">+</span><span class="n">runenv</span><span class="o">.</span><span class="n">jobserver</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">tdir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update_ppdt_pir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_basepir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.base.pdb&#39;</span><span class="p">)</span>
        <span class="n">basepir</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;base.pir&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">bpl</span><span class="o">=</span><span class="n">basepir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-1.00</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">sl</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bpl</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span><span class="o">/</span><span class="mi">50</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">basepir</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;A&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sl</span><span class="p">)])</span>
        <span class="k">print</span> <span class="n">basepir</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.pir&#39;</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">fc</span><span class="o">=</span><span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">fc</span><span class="o">=</span><span class="n">fc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;ACS&#39;</span><span class="p">,</span><span class="n">basepir</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.pir&#39;</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fc</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fc</span>
         
    <span class="k">def</span> <span class="nf">get_sorted_rmsdlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">runenv</span><span class="o">.</span><span class="n">decoysbasedir</span><span class="o">+</span><span class="s">&#39;ddbrmsds/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.rmsds&#39;</span><span class="p">)</span>
        <span class="n">codere</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;and\s*(\S*)\s*is\s*([.0-9]*)&#39;</span><span class="p">)</span>
        <span class="n">rmsddict</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">rmsdlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fh</span><span class="p">:</span>
            <span class="n">codeg</span><span class="o">=</span><span class="n">codere</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">codeg</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">coden</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">codeg</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">coden</span><span class="o">=</span><span class="n">codeg</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">coden</span><span class="o">=</span><span class="n">coden</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">rmsddict</span><span class="p">[</span><span class="n">coden</span><span class="p">]</span><span class="o">=</span><span class="n">codeg</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">rmsdlist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">coden</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">codeg</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))])</span>
            <span class="n">rmsdlist</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmsdlist</span><span class="o">=</span><span class="n">rmsdlist</span>
        <span class="k">return</span> <span class="n">rmsdlist</span>
    
    <span class="k">def</span> <span class="nf">filter_rmsdlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dnlist</span><span class="p">):</span>
        <span class="n">newrmsdlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rmsdlist</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">dnlist</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rmsdlist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">newrmsdlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rmsdlist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmsdlist</span><span class="o">=</span><span class="n">newrmsdlist</span>
         
    <span class="k">def</span> <span class="nf">get_sorted_pir_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="mi">0</span>
     
    <span class="k">def</span> <span class="nf">rmsd_2file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file1</span><span class="p">,</span><span class="n">file2</span><span class="p">,</span><span class="n">rmsdtype</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">,</span><span class="n">looprmsd</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">nofit</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">e</span><span class="o">=</span><span class="n">runenv</span><span class="o">.</span><span class="n">env</span>
	<span class="n">aln</span><span class="o">=</span><span class="n">alignment</span><span class="p">(</span><span class="n">runenv</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
	<span class="n">m1</span><span class="o">=</span><span class="n">Mymodel</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="nb">file</span><span class="o">=</span><span class="n">file1</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;start calculating rmsd&#39;</span>
	<span class="k">print</span> <span class="n">file1</span>
	<span class="n">aln</span><span class="o">.</span><span class="n">append_model</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">align_codes</span><span class="o">=</span><span class="s">&#39;c1&#39;</span><span class="p">,</span> <span class="n">atom_files</span><span class="o">=</span><span class="n">file1</span><span class="p">)</span>
	<span class="k">print</span> <span class="n">file2</span>
	<span class="n">m2</span><span class="o">=</span><span class="n">Mymodel</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="nb">file</span><span class="o">=</span><span class="n">file2</span><span class="p">)</span>
	<span class="n">aln</span><span class="o">.</span><span class="n">append_model</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">align_codes</span><span class="o">=</span><span class="s">&#39;c2&#39;</span><span class="p">,</span> <span class="n">atom_files</span><span class="o">=</span><span class="n">file2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">looprmsd</span><span class="p">:</span>
            <span class="n">atmsel</span><span class="o">=</span><span class="n">m1</span><span class="o">.</span><span class="n">select_loop_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loops</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">atmsel</span><span class="o">=</span><span class="n">selection</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">rmsdtype</span><span class="o">==</span><span class="s">&#39;all&#39;</span><span class="p">:</span>
	    <span class="k">pass</span>
	<span class="k">elif</span> <span class="n">rmsdtype</span><span class="o">==</span><span class="s">&#39;mcrmsd&#39;</span><span class="p">:</span>
            <span class="n">atmsel</span> <span class="o">=</span> <span class="n">atmsel</span><span class="o">.</span><span class="n">only_mainchain</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">rmsdtype</span><span class="o">==</span><span class="s">&#39;scrmsd&#39;</span><span class="p">:</span>
	    <span class="n">atmsel</span> <span class="o">=</span> <span class="n">atmsel</span><span class="o">.</span><span class="n">only_sidechain</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Unknown rmsdtype: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rmsdtype</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">nofit</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">atmsel</span><span class="o">.</span><span class="n">superpose</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">aln</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span><span class="o">=</span><span class="n">atmsel</span><span class="o">.</span><span class="n">superpose</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">aln</span><span class="p">,</span><span class="n">fit</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">refine_local</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
	<span class="c"># We can now use the calculated RMS, DRMS, etc. from the returned &#39;r&#39; object:</span>
	<span class="n">rms</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">rms</span>
	<span class="n">drms</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">drms</span>
	<span class="k">print</span> <span class="n">rms</span>
        <span class="k">print</span> <span class="s">&#39;finished calculating rmsd&#39;</span>
	<span class="k">return</span> <span class="n">rms</span>
    
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">+</span><span class="s">&#39;.pickle&#39;</span><span class="p">,</span><span class="s">&#39;wb&#39;</span><span class="p">)</span>
        <span class="n">cPickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fh</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">+</span><span class="s">&#39;.pickle&#39;</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
        <span class="n">no</span><span class="o">=</span><span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">no</span>

    <span class="k">def</span> <span class="nf">replicate_pir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">basepir</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;base.pir&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">totalpir</span><span class="o">=</span><span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">dn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">:</span>
            <span class="n">totalpir</span><span class="o">=</span><span class="n">totalpir</span><span class="o">+</span><span class="n">basepir</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;base&#39;</span><span class="p">,</span><span class="n">dn</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.pir&#39;</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">totalpir</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">+</span><span class="s">&#39;.pickle&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">add_property_tosa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">dnlist</span><span class="p">,</span><span class="nb">property</span><span class="o">=</span><span class="s">&#39;mcrmsd&#39;</span><span class="p">,</span><span class="n">ddbdir</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">ddbdir</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">dnlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.native.pdb&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dnlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.native.pdb.gz&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dnlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.native&#39;</span><span class="p">)):</span>
            <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;The first structure in dnlist is not native structure&#39;</span><span class="p">)</span>
        <span class="n">nativefile</span><span class="o">=</span><span class="n">dnlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_loop_region</span><span class="p">(</span><span class="n">nativefile</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loops</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">looprmsd</span><span class="o">=</span><span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">looprmsd</span><span class="o">=</span><span class="bp">False</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">environ</span><span class="p">()</span>
	<span class="n">e</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">atom_files_directory</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;./&#39;</span><span class="p">]</span>    
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dnlist</span><span class="p">)):</span>
            <span class="k">print</span> <span class="n">dnlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;  &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;rmsd&#39;</span><span class="p">])</span>
            <span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="nb">property</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rmsd_2file</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">nativefile</span><span class="o">+</span><span class="s">&#39;.pdb&#39;</span><span class="p">,</span><span class="n">dnlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;.pdb&#39;</span><span class="p">,</span><span class="n">rmsdtype</span><span class="o">=</span><span class="nb">property</span><span class="p">,</span><span class="n">looprmsd</span><span class="o">=</span><span class="n">looprmsd</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_loop_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dname</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dname</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s">&#39;ml&#39;</span><span class="p">,</span><span class="s">&#39;mgl&#39;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loops</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">ns</span><span class="o">=</span><span class="n">dname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">lcode</span><span class="o">=</span><span class="n">ns</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span>
        <span class="n">lcode</span><span class="o">=</span><span class="n">lcode</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">)</span>
        <span class="n">rer</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;([0-9]{1,4})([a-zA-Z\s]{1,2})([0-9]{1,4})&#39;</span><span class="p">,</span><span class="n">lcode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loops</span><span class="o">=</span><span class="p">[[</span><span class="n">rer</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">rer</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span><span class="nb">int</span><span class="p">(</span><span class="n">rer</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span><span class="nb">int</span><span class="p">(</span><span class="n">rer</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">rer</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
                </div>
<div class="viewcode-block" id="decoyset"><a class="viewcode-back" href="../decoys.html#decoys.decoyset">[docs]</a><span class="k">class</span> <span class="nc">decoyset</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The pre-prepared decoys directory should looks like the following:</span>
<span class="sd">        root:</span>
<span class="sd">            decoySet1: could use the PDB code of the receptor here</span>
<span class="sd">                Decoy files</span>
<span class="sd">                [*base*]: if this file is present in this directory, it should be the receptor file shared by all decoys, and the final decoys are generated by combining this</span>
<span class="sd">                rmsd.pickle</span>
<span class="sd">            decoySet2</span>
<span class="sd">            ...</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dsname</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">sourcedir</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">=</span><span class="n">dsname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">=</span><span class="n">runenv</span><span class="o">.</span><span class="n">decoysbasedir</span><span class="o">+</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;/&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">+</span><span class="n">dsname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pirpath</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">+</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.pir&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourcedir</span><span class="o">=</span><span class="n">sourcedir</span>
        
    <span class="k">def</span> <span class="nf">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">clean_pir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pirpath</span><span class="p">)</span><span class="o">.</span><span class="n">get_pir_fromlist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pirpath</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">bulid_rmsd_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sal</span><span class="p">):</span>
        <span class="c">#build the rmsd score array based on all the known parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">=</span><span class="n">sal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">+</span><span class="n">sal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extrapar</span>
        <span class="n">itemlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">+</span><span class="n">sal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extrapar</span><span class="p">:</span>
            <span class="n">itemlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">sal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sa</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="c">#,(&#39;decoyn&#39;,&#39;a50&#39;)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="s">&#39;decoyseqposn&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="n">i</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="s">&#39;decoyposn&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">itemlist</span><span class="p">[</span><span class="mi">3</span><span class="p">:]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="n">sal</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
                        
    <span class="k">def</span> <span class="nf">get_codelist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#get the list of decoy sequences</span>
        <span class="n">rmsdfiles</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">runenv</span><span class="o">.</span><span class="n">decoysbasedir</span><span class="o">+</span><span class="s">&#39;ddbrmsds/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">rmsdfiles</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">pre_build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sourcedir</span><span class="p">)</span>
        <span class="n">folderlist</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&#39;./&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folderlist</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sourcedir</span><span class="o">+</span><span class="n">folder</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sourcedir</span><span class="o">+</span><span class="n">folder</span><span class="p">)</span>
            <span class="n">subfolderlist</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&#39;./&#39;</span><span class="p">)</span>            
            <span class="k">for</span> <span class="n">subfolder</span> <span class="ow">in</span> <span class="n">subfolderlist</span><span class="p">:</span>
                <span class="c">#if subfolder[-10:]==&#39;.coord.pdb&#39;:</span>
                <span class="c">#    if os.path.isfile(subfolder[-10:]+&#39;.pdb&#39;):</span>
                <span class="c">#        print os.system(&#39;rm &#39;+subfolder)</span>
                <span class="c">#        continue</span>
                <span class="c">#    print os.system(&#39;python ../ergePDB.py &#39;+subfolder[:-10]+&#39; &#39;+folder+&#39; &#39;+subfolder[:-10])</span>
                <span class="c">#    print os.system(&#39;rm &#39;+subfolder)</span>
                <span class="c">#print os.system(&#39;mv  ./&#39;+subfolder+&#39;/&#39;+subfolder+&#39;.pdb ./&#39;+folder+&#39;/&#39;+subfolder+&#39;/&#39;+subfolder+&#39;.native.pdb&#39;)</span>
                <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;mv  ./&#39;</span><span class="o">+</span><span class="n">subfolder</span><span class="o">+</span><span class="s">&#39; ../&#39;</span><span class="o">+</span><span class="n">subfolder</span><span class="p">)</span>
            <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;rm -r ../&#39;</span><span class="o">+</span><span class="n">folder</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sourcedir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
        <span class="n">codelist</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
        <span class="n">fl</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&#39;./&#39;</span><span class="p">)</span>
        <span class="n">fll</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fl</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="n">fll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="o">=</span><span class="n">fll</span>
        <span class="n">sdl</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">tdir</span><span class="o">=</span><span class="n">runenv</span><span class="o">.</span><span class="n">serverUserPath</span><span class="o">+</span><span class="s">&#39;decoys/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;ssh &#39;</span><span class="o">+</span><span class="n">runenv</span><span class="o">.</span><span class="n">jobserver</span><span class="o">+</span><span class="s">&#39; mkdir &#39;</span><span class="o">+</span><span class="n">tdir</span><span class="p">)</span>
        <span class="n">sal</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cat_singles</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bulid_rmsd_array</span><span class="p">(</span><span class="n">sal</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;building array finished&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">filter2good</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bnors</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span><span class="n">scorefile</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">scorefile</span><span class="p">:</span>
            <span class="n">rsp</span><span class="o">=</span><span class="n">rawsp</span><span class="p">(</span><span class="n">pdbset</span><span class="o">=</span><span class="s">&#39;X_2.2A&#39;</span><span class="p">,</span><span class="n">features</span><span class="o">=</span><span class="s">&#39;a158a158d30&#39;</span><span class="c">#,&#39;a158a158d30&#39;,&#39;a158a158d200&#39;,&#39;a158a158d300&#39;]</span>
                 <span class="p">,</span><span class="n">genmethod</span><span class="o">=</span><span class="s">&#39;ss1&#39;</span><span class="p">)</span>
            <span class="n">ssp</span><span class="o">=</span><span class="n">scaledsp</span><span class="p">(</span><span class="n">rspo</span><span class="o">=</span><span class="n">rsp</span><span class="p">,</span><span class="n">pm</span><span class="o">=</span><span class="s">&#39;npend&#39;</span><span class="p">)</span>
            <span class="n">sps</span><span class="o">=</span><span class="n">spdsscore</span><span class="p">(</span><span class="n">ssp</span><span class="o">=</span><span class="n">ssp</span><span class="p">,</span><span class="n">dslist</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="p">],</span><span class="n">bm</span><span class="o">=</span><span class="s">&#39;ss1&#39;</span><span class="p">)</span>
            <span class="n">sps</span><span class="o">.</span><span class="n">test</span><span class="o">=</span><span class="bp">True</span>
            <span class="n">sps</span><span class="o">.</span><span class="n">get_score</span><span class="p">()</span>
            <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">runenv</span><span class="o">.</span><span class="n">basedir</span><span class="o">+</span><span class="s">&#39;X_2.2A/a158a158d30-ss3/X_2.2A.a158a158d30.ss1.npend.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;.ss1.pickle&#39;</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">scorefile</span><span class="p">)</span>
        <span class="n">spscore</span><span class="o">=</span><span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">ndnlist</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="n">spscore</span><span class="p">)</span>
        <span class="n">odnlist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">odnlist</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">odnlist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">40</span><span class="p">:</span>
                <span class="n">odnlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">odnlist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">40</span><span class="p">]</span>
        <span class="n">dnlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="c">#rmsdlist=[]</span>
        <span class="n">codelist</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ind</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">dpn</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="p">)):</span>
            <span class="k">print</span> <span class="s">&quot;filtering &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">k</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">odnlist</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ndnlist</span><span class="p">)</span> <span class="ow">and</span> <span class="n">odnlist</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="p">)]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="p">:</span>
                    <span class="c">#rmsdlist.append(self.rmsds[j])</span>
                    <span class="n">dnlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span>
                    <span class="n">ind</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">codelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="s">&#39;decoyseqposn&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="n">dpn</span> 
            <span class="n">pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">k</span><span class="p">)</span>
            <span class="n">dpn</span><span class="o">=</span><span class="n">dpn</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dnlist</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.8</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">odnlist</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&#39;Error: too many decoys (&gt;20%) are filtered out using the filter, please check code for bugs&#39;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s">&#39;Error: too many decoys (&gt;20%) are filtered out using the filter, please check code for bugs&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="o">=</span><span class="n">pos</span>
        <span class="c">#self.rmsds=rmsdlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="o">=</span><span class="n">dnlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="o">=</span><span class="n">codelist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="s">&#39;decoyposn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clean_pir</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>        
    
    <span class="k">def</span> <span class="nf">cat_singles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sdl</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dnlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">sal</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">pirlist</span><span class="o">=</span><span class="s">&#39;&#39;</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;ssh &#39;</span><span class="o">+</span><span class="n">runenv</span><span class="o">.</span><span class="n">jobserver</span><span class="o">+</span><span class="s">&#39; mkdir ~/decoys/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;##############################################buiding decoys&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span>
        <span class="c">#runtask=task()</span>
        <span class="c">#runtask.parallel_local(self.build_single,inputlist=self.codelist,nors=10)</span>
        <span class="c">#pdb.set_trace()</span>
        <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;***********building &quot;</span><span class="o">+</span><span class="n">code</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_single</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
            <span class="n">sd</span><span class="o">=</span><span class="n">decoys4single</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sourcedir</span><span class="o">+</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>  
            <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sourcedir</span><span class="o">+</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="o">+</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;.pickle&#39;</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
            <span class="n">sd</span><span class="o">=</span><span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">dnlist</span><span class="o">=</span><span class="n">dnlist</span><span class="o">+</span><span class="n">sd</span><span class="o">.</span><span class="n">dnlist</span>
            <span class="n">sal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sd</span><span class="p">)</span>
            <span class="n">pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">dnlist</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">dnlist</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Bugs</span><span class="p">(</span><span class="s">&#39;Only 1 decoys in the decoy set, probably something wrong with it&#39;</span><span class="p">)</span>
            <span class="n">pirlist</span><span class="o">=</span><span class="n">pirlist</span><span class="o">+</span><span class="n">sd</span><span class="o">.</span><span class="n">path</span><span class="o">+</span><span class="s">&#39;.pir &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="o">=</span><span class="n">pos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="o">=</span><span class="n">dnlist</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;cat &#39;</span><span class="o">+</span><span class="n">pirlist</span><span class="o">+</span><span class="s">&#39; &gt;&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">pirpath</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sal</span>
    
    <span class="k">def</span> <span class="nf">build_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">code</span><span class="p">):</span>
        <span class="n">sd</span><span class="o">=</span><span class="n">decoys4single</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sourcedir</span><span class="o">+</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;generating decoy for &#39;</span><span class="o">+</span><span class="n">code</span>
        <span class="n">sd</span><span class="o">=</span><span class="n">sd</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&#39;generating finished &#39;</span><span class="o">+</span><span class="n">code</span>
        <span class="k">return</span> <span class="n">sd</span>
    
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mypickle</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="p">)</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
            <span class="n">mypickle</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mypickle</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rebuild</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">+</span><span class="s">&#39;.pickle&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rebuild</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">check_decoys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">:</span>
            <span class="n">code1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>    
            <span class="n">code2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">fh1</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">runenv</span><span class="o">.</span><span class="n">ddbdir</span><span class="o">+</span><span class="n">code1</span><span class="o">+</span><span class="s">&#39;.pdb&#39;</span><span class="p">)</span>
            <span class="n">fh2</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">runenv</span><span class="o">.</span><span class="n">ddbdir</span><span class="o">+</span><span class="n">code2</span><span class="o">+</span><span class="s">&#39;.pdb&#39;</span><span class="p">)</span>
            <span class="n">fh1c</span><span class="o">=</span><span class="n">fh1</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">fh2c</span><span class="o">=</span><span class="n">fh2</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">l1</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">nATOM&#39;</span><span class="p">,</span><span class="n">fh1c</span><span class="p">))</span>
            <span class="n">l2</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">nATOM&#39;</span><span class="p">,</span><span class="n">fh2c</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">l1</span><span class="o">!=</span><span class="n">l2</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">code1</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_ppdt_pir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pirlist</span><span class="o">=</span><span class="s">&#39;&#39;</span>
        <span class="n">ss</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">ss</span><span class="o">.</span><span class="n">codelist</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sourcedir</span><span class="o">+</span><span class="n">code</span><span class="p">)</span>
            <span class="n">sd</span><span class="o">=</span><span class="n">decoys4single</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sourcedir</span><span class="o">+</span><span class="n">code</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">sd</span><span class="o">.</span><span class="n">update_ppdt_pir</span><span class="p">()</span>
            <span class="n">pirlist</span><span class="o">=</span><span class="n">pirlist</span><span class="o">+</span><span class="n">sd</span><span class="o">.</span><span class="n">path</span><span class="o">+</span><span class="s">&#39;.pir &#39;</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;cat &#39;</span><span class="o">+</span><span class="n">pirlist</span><span class="o">+</span><span class="s">&#39; &gt;&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">pirpath</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">get_loopdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dp</span><span class="p">):</span>
        <span class="n">ld</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">codelist</span><span class="p">:</span>
            <span class="n">rer</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;([0-9]+)([A-Z\-]{1})([0-9]+)&#39;</span><span class="p">,</span><span class="n">code</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span>
            <span class="n">cl</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">rer</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">cs</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">rer</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">cc</span><span class="o">=</span><span class="n">rer</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cc</span><span class="o">==</span><span class="s">&#39;-&#39;</span><span class="p">:</span>
                <span class="n">cc</span><span class="o">=</span><span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">code</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ld</span><span class="p">:</span>
                <span class="n">ld</span><span class="p">[</span><span class="n">code</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">cc</span><span class="p">,</span><span class="n">cl</span><span class="p">,</span><span class="n">cs</span><span class="p">,</span><span class="n">cs</span><span class="o">+</span><span class="n">cl</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ld</span><span class="p">[</span><span class="n">code</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]]</span><span class="o">=</span><span class="p">[[</span><span class="n">cc</span><span class="p">,</span><span class="n">cl</span><span class="p">,</span><span class="n">cs</span><span class="p">,</span><span class="n">cs</span><span class="o">+</span><span class="n">cl</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">ld</span><span class="p">,</span><span class="n">fh</span><span class="p">)</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">build_index_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indexlist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]])</span>

    <span class="k">def</span> <span class="nf">get_codepos_fordifferentset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sposindex</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">codepos</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indexlist</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexlist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">spos</span><span class="p">[</span><span class="n">sposindex</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexlist</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">spos</span><span class="p">[</span><span class="n">sposindex</span><span class="p">]:</span>
                <span class="n">codepos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">sposindex</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">codepos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indexlist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setpos</span><span class="o">=</span><span class="n">codepos</span>
        
    <span class="k">def</span> <span class="nf">rename_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;dslist&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dsname</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setpos</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setpos</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">setpos</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dslist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">add_property_tosa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="s">&#39;mcrmsd&#39;</span><span class="p">,</span><span class="n">ddbdir</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rebuild_codelist</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="nb">property</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="o">.</span><span class="n">dtype</span><span class="p">)):</span>
            <span class="n">sa</span><span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="o">=</span><span class="n">sa</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">singlecode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">decoys4single</span><span class="p">(</span><span class="n">singlecode</span><span class="p">)</span><span class="o">.</span><span class="n">add_property_tosa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span><span class="nb">property</span><span class="p">,</span><span class="n">ddbdir</span><span class="o">=</span><span class="n">ddbdir</span><span class="o">+</span><span class="n">singlecode</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">rebuild_codelist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">codelist</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">codelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="o">=</span><span class="n">codelist</span>
        </div>
<span class="k">class</span> <span class="nc">decoysets</span><span class="p">(</span><span class="n">decoyset</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dslist</span><span class="o">=</span><span class="p">[],</span><span class="n">sourcedir</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dslist</span><span class="o">=</span><span class="n">dslist</span>
        <span class="n">decoyset</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dslist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourcedir</span><span class="o">=</span><span class="n">sourcedir</span>
        
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rebuild</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
        <span class="n">dss</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmsds</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spos</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">dsname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dslist</span><span class="p">:</span>
           <span class="n">ds</span><span class="o">=</span><span class="n">decoyset</span><span class="p">(</span><span class="n">dsname</span><span class="p">,</span><span class="n">sourcedir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sourcedir</span><span class="o">+</span><span class="n">dsname</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
           <span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rebuild</span><span class="p">)</span>
           <span class="n">dss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="o">+</span><span class="n">ds</span><span class="o">.</span><span class="n">dnlist</span>
           <span class="c">#self.rmsds=self.rmsds+ds.rmsds</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="o">+</span><span class="n">ds</span><span class="o">.</span><span class="n">codelist</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">item</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">spos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">pos</span><span class="p">]</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">spos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">dnlist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cat_rmsd_array</span><span class="p">(</span><span class="n">dss</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gen_pir</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>
        
    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rebuild</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rebuild</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
           
    <span class="k">def</span> <span class="nf">cat_rmsd_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dss</span><span class="p">):</span>
        <span class="c">#build the rmsd score array based on all the known parameters</span>
        <span class="n">itemlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">=</span><span class="n">dss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sa</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">descr</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">:</span>
            <span class="n">itemlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnlist</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sa</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="c">#,(&#39;decoyn&#39;,&#39;a50&#39;)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spos</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="s">&#39;decoyset&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">spos</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">spos</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="n">i</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="s">&#39;decoyseqposn&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">spos</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">spos</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="n">dss</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="s">&#39;decoyseqposn&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="s">&#39;decoyposn&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">spos</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">spos</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spos</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">spos</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">itemlist</span><span class="p">[</span><span class="mi">3</span><span class="p">:]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">spos</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">spos</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="n">dss</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>    

    <span class="k">def</span> <span class="nf">filter2good</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">dsname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dslist</span><span class="p">:</span>
            <span class="n">decoyset</span><span class="p">(</span><span class="n">dsname</span><span class="o">=</span><span class="n">dsnmae</span><span class="p">)</span><span class="o">.</span><span class="n">filter2good</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_oldlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#use this function to load the rmsdlist generated by old codes</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">runenv</span><span class="o">.</span><span class="n">basedir</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;DecoysRUS&#39;</span><span class="p">,</span><span class="s">&#39;HR&#39;</span><span class="p">,</span><span class="s">&#39;casp58&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;DecoysRUS&#39;</span><span class="p">,</span><span class="s">&#39;HR&#39;</span><span class="p">,</span><span class="s">&#39;casp58&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;.rmsdlist&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">calc_nativelist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rmsdlist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">load_oldlist</span><span class="p">()</span>
        <span class="n">sa</span><span class="o">=</span><span class="n">rmsdlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#sas=np.sort(sa,order=[&#39;decoyset&#39;,&#39;decoyseqposn&#39;,&#39;rmsd&#39;])</span>
        <span class="n">dnlist</span><span class="o">=</span><span class="n">rmsdlist</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">nativelist</span><span class="o">=</span><span class="p">[</span><span class="n">dnlist</span><span class="p">[</span><span class="n">sa</span><span class="p">[</span><span class="s">&#39;decoyposn&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dnlist</span><span class="p">))</span> <span class="k">if</span> <span class="p">(</span><span class="n">sa</span><span class="p">[</span><span class="s">&#39;rmsd&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">sa</span><span class="p">[</span><span class="s">&#39;decoyset&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gen_pir</span><span class="p">()</span>
    <span class="c">#    pirfile=pir(self.pirpath)</span>
    <span class="c">#    pirfile.get_pir_fromlist(nativelist,self.pirpath[:-3]+&#39;native.pir&#39;)</span>
        <span class="n">nlfh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">+</span><span class="s">&#39;nativelist&#39;</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">nlfh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">nativelist</span><span class="p">))</span>
        <span class="n">nlfh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">nativelist</span>
    
    <span class="k">def</span> <span class="nf">load_nativelist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nlfh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">+</span><span class="s">&#39;nativelist&#39;</span><span class="p">)</span>
        <span class="n">nlc</span><span class="o">=</span><span class="n">nlfh</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">nlc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">get_nativelist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">+</span><span class="s">&#39;nativelist&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_nativelist</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_nativelist</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">gen_pir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dslist</span><span class="p">)):</span>
            <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;cp &#39;</span><span class="o">+</span><span class="n">decoyset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dslist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">pirpath</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">+</span><span class="s">&#39;set&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;.pir&#39;</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;cat &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">+</span><span class="s">&#39;set*pir &gt; &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">pirpath</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;rm &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">+</span><span class="s">&#39;set*pir&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_ds_part</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sample</span><span class="p">):</span>
        <span class="n">sset</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
        <span class="n">codelist</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">codelist2</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">indexlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">indexlist2</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="p">)):</span>
            <span class="n">code</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">sset</span><span class="p">:</span>
                <span class="n">codelist2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                <span class="n">indexlist2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indexlist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">codelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                <span class="n">indexlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indexlist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>         
        <span class="n">nds</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">nds</span><span class="o">.</span><span class="n">indexlist</span><span class="o">=</span><span class="n">indexlist</span>
        <span class="n">nds</span><span class="o">.</span><span class="n">codelist</span><span class="o">=</span><span class="n">codelist</span>
        <span class="n">nds</span><span class="o">.</span><span class="n">get_codepos_fordifferentset</span><span class="p">()</span>
        <span class="n">nds2</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">nds2</span><span class="o">.</span><span class="n">indexlist</span><span class="o">=</span><span class="n">indexlist2</span>
        <span class="n">nds2</span><span class="o">.</span><span class="n">codelist</span><span class="o">=</span><span class="n">codelist2</span>
        <span class="n">nds2</span><span class="o">.</span><span class="n">get_codepos_fordifferentset</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">nds</span><span class="p">,</span><span class="n">nds2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_ds_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ndslist</span><span class="o">=</span><span class="p">[</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="p">))]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="p">)):</span>
            <span class="n">ndslist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">codelist</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="n">ndslist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">indexlist</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indexlist</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="n">ndslist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_codepos_fordifferentset</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ndslist</span>

    <span class="k">def</span> <span class="nf">add_property_tosa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">property</span><span class="o">=</span><span class="s">&#39;mcrmsd&#39;</span><span class="p">,</span><span class="n">ddbdir</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rebuild_codelist</span><span class="p">()</span>
        <span class="kn">from</span> <span class="nn">numpy.lib.recfunctions</span> <span class="kn">import</span> <span class="n">append_fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="o">=</span><span class="n">append_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">)),</span><span class="n">names</span><span class="o">=</span><span class="nb">property</span><span class="p">,</span><span class="n">dtypes</span><span class="o">=</span><span class="s">&#39;f4&#39;</span><span class="p">,</span><span class="n">usemask</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dslist</span><span class="p">)):</span>
            <span class="n">decoyset</span><span class="p">(</span><span class="n">dsname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dslist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">add_property_tosa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">spos</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">spos</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span><span class="nb">property</span><span class="p">,</span><span class="n">ddbdir</span><span class="o">=</span><span class="n">ddbdir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dslist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;dss&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mode</span><span class="o">==</span><span class="s">&#39;dss&#39;</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s">&#39;dss.pickle&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">mypickle</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;dss&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dslist</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">ndss</span><span class="o">=</span><span class="n">decoyset</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ndss</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                <span class="n">ndss</span><span class="o">.</span><span class="n">rebuild_codelist</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dslist</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">ndss</span><span class="o">.</span><span class="n">spos</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ndss</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">ndss</span><span class="o">.</span><span class="n">build_index_list</span><span class="p">()</span>
                <span class="n">ndss</span><span class="o">.</span><span class="n">get_codepos_fordifferentset</span><span class="p">()</span>
                <span class="n">ndss</span><span class="o">.</span><span class="n">rename_codes</span><span class="p">()</span>
                <span class="n">nds</span><span class="o">=</span><span class="n">decoysets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dslist</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">ndss</span><span class="o">.</span><span class="n">dnlist</span>
                <span class="n">nds</span><span class="o">.</span><span class="n">pos</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">ndss</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
                <span class="c">#self.ds.spos=copy.copy(nds.spos)</span>
                <span class="n">nds</span><span class="o">.</span><span class="n">codelist</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">ndss</span><span class="o">.</span><span class="n">codelist</span><span class="p">)</span>
                <span class="n">nds</span><span class="o">.</span><span class="n">sa</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">ndss</span><span class="o">.</span><span class="n">sa</span><span class="p">)</span>
                <span class="n">nds</span><span class="o">.</span><span class="n">spos</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">ndss</span><span class="o">.</span><span class="n">spos</span><span class="p">)</span>
                <span class="n">nds</span><span class="o">.</span><span class="n">indexlist</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">ndss</span><span class="o">.</span><span class="n">indexlist</span><span class="p">)</span>
                <span class="n">nds</span><span class="o">.</span><span class="n">setpos</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">ndss</span><span class="o">.</span><span class="n">setpos</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">ndss</span>
                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>
                <span class="n">mypickle</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nds</span><span class="p">,</span><span class="s">&#39;dss&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">nds</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dslist</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">ndss</span><span class="o">=</span><span class="n">decoyset</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ndss</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">ndss</span><span class="o">.</span><span class="n">rebuild_codelist</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dslist</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">ndss</span><span class="o">.</span><span class="n">spos</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ndss</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">ndss</span><span class="o">.</span><span class="n">build_index_list</span><span class="p">()</span>
            <span class="n">ndss</span><span class="o">.</span><span class="n">get_codepos_fordifferentset</span><span class="p">()</span>
            <span class="n">ndss</span><span class="o">.</span><span class="n">rename_codes</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">ndss</span>

    <span class="k">def</span> <span class="nf">get_rmsd_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">rmsdtype</span><span class="o">=</span><span class="s">&#39;rmsd&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmsdarray</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indexlist</span><span class="p">),</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">poslist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">indexlist</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">poslist</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">withnative</span><span class="p">:</span>
                <span class="n">rmsds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="n">poslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">poslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rmsds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="n">poslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="n">poslist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rmsdarray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">rmsds</span><span class="p">[</span><span class="n">rmsdtype</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">num</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">rmsdl</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setpos</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">nod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setpos</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">setpos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">srmsd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rmsdarray</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">setpos</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">setpos</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">rmsdl</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">dslist</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="p">[</span><span class="n">srmsd</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">srmsd</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span><span class="n">srmsd</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">srmsd</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
        <span class="k">print</span> <span class="n">rmsdl</span>
        <span class="k">return</span> <span class="n">rmsdl</span>

    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fa</span><span class="p">):</span>
        <span class="c">#self.codelist=self.codelist #</span>
        <span class="c">#self.pos #pos in sa</span>
        <span class="c">#self.spos #setpos in sa</span>
        <span class="c">#self.indexlist=copy.copy(nds.indexlist)</span>
        <span class="c">#self.setpos #setpos in codelist #</span>
        <span class="c">#pdb.set_trace()</span>
        <span class="c">#if len(self.indexlist) != len(self.pos)-1:</span>
        <span class="c">#    raise Exception(&#39;decoysets.filter() can only be run on full decoy set, indexlist must cover all decoys&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="p">[</span><span class="n">fa</span><span class="p">]</span>
        <span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">spos</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">indexlist</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">codelist</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">setpos</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dslist</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">sk</span><span class="o">=-</span><span class="mi">1</span>
        <span class="n">k</span><span class="o">=-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setpos</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">sk</span><span class="o">=</span><span class="n">sk</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexlist</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">setpos</span><span class="p">[</span><span class="n">sp</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">setpos</span><span class="p">[</span><span class="n">sp</span><span class="o">+</span><span class="mi">1</span><span class="p">]]:</span>
                <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">fa</span><span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">fa</span><span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
                    <span class="n">indexlist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pos</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
                    <span class="n">codelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">spos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>    
                <span class="n">spos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">dslist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dslist</span><span class="p">[</span><span class="n">sk</span><span class="p">])</span>
                <span class="n">setpos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">codelist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="o">=</span><span class="n">pos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spos</span><span class="o">=</span><span class="n">spos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexlist</span><span class="o">=</span><span class="n">indexlist</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">sa</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Error in filtering...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setpos</span><span class="o">=</span><span class="n">setpos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">codelist</span><span class="o">=</span><span class="n">codelist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dslist</span><span class="o">=</span><span class="n">dslist</span>
        

        
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">SOAP 0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Guangqiang Dong.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>